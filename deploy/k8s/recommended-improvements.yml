# Recommended improvements for production deployment

# 1. Increase replicas for high availability
# For web deployment:
spec:
  replicas: 3  # Minimum for production
  
# For API services:
spec:
  replicas: 2  # Minimum for API services

# 2. Add Pod Disruption Budgets
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: web-pdb
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: web
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: crm-api-pdb
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: crm-api
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: scheduling-api-pdb
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: scheduling-api

# 3. Add namespace definition
---
apiVersion: v1
kind: Namespace
metadata:
  name: kdvmanager-prod
  labels:
    name: kdvmanager-prod
    environment: production

# 4. Resource limits for web and envoy (currently missing)
---
# Add to web deployment
spec:
  template:
    spec:
      containers:
      - name: web
        resources:
          limits:
            memory: 512Mi
            cpu: 500m
          requests:
            memory: 256Mi
            cpu: 200m

# 5. Security contexts (add to all deployments)
---
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 2000
      containers:
      - name: container-name
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
            - ALL

# 6. Health checks for web deployment (currently missing)
---
# Add to web deployment
spec:
  template:
    spec:
      containers:
      - name: web
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
